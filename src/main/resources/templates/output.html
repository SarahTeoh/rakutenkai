<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="/fragments/base :: head">
</head>

<body>

<script type="text/javascript">
    function getAge(dateString) {
        console.log(dateString);
        let today = new Date();
        let birthDate = new Date(dateString);
        let age = today.getFullYear() - birthDate.getFullYear();
        let m = today.getMonth() - birthDate.getMonth();

        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }

        return age;
    }


</script>

<div th:replace="/fragments/base :: navbar">
</div>
<h1>Search results</h1>
<!--    <div th:replace="/fragments/map :: body"></div>-->
<form>
    <table>
        <tr th:each="user : ${users}" th:object="${user}">
            <td>
                <img class="img-responsive" th:src="${'https://i.pravatar.cc/150/img=' + user.id}">
            </td>
            <td>
                Name: <span th:text="*{name}"></span><br>
                Location: <span th:text="*{country} + ' - ' + *{city}"></span><br>
                Age: <span th:text="${user.getAge()}"></span><br>
<!--                Can help with: <span th:each=" tag, tStat : *{tags}" th:text="${tag.name} + ' '" ></span><br>-->
<!--                Can help with: <span th:each=" tag, tStat : *{tags}" th:text="${tStat.index == 2}? 'and more' : ${tag.name} + ', '" th:unless="${tStat.index > 2}" ></span><br>-->
                Can help with: <span class="tag" th:each=" tag, tStat : *{tags}" th:text="${tStat.index >= 1}? (${tStat.index == 3}? ', and more' : ', ' + ${tag.name}) : ${tag.name}" th:unless="${tStat.index > 3}" ></span><br>
            </td>
            <td>
                <button type="button" th:onclick="'window.location.href=\'/user/' +  *{id} + '\''"
                        class="btn btn-primary">View Details
                </button>
            </td>
        </tr>

        <!--
            <tr th:each="user : ${users}">
                <tr>
                    <td colspan="3" rowspan="3">Picture here.</td>
                    <td>User name</td>
                    <td th:text="${user.userName"></td>
                </tr>
                <tr>
                    <td>Country</td>
                    <td th:text="${user.country"></td>
                </tr>
                <tr>
                    <td>Age</td>
                    <td th:text="${user.age"></td>
                </tr>
            </tr>
        -->
    </table>
</form>
<!--<div th:replace="/fragments/base :: footer"></div>-->
<div th:replace="/fragments/base :: script-import"></div>
</body>
</html>