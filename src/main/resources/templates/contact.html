<html xmlns:th="http://www.w3.org/1999/xhtml">

<head th:replace="/fragments/base :: head">
</head>

<body>

<div th:replace="/fragments/base :: navbar">
</div>

<h1>Message</h1>

<div id="scrollTable" style="height: 500px; overflow-y: scroll;">
  <table style="table-layout: fixed; width: 100%;">
    <tr th:each="message : ${messages}">
      <th:block th:if="${message.user.id == idFrom}">
        <td align="right">
          <img class="img-responsive" th:src="${'https://i.pravatar.cc/150/img=' + message.user.id}" style="width: 150px; height: 150px;" >
          <div th:text="${message.user.name}"></div>
          <div th:text="${message.content}"></div>
          <div th:text="${#temporals.format(message.timestamp, 'HH:mm')}"></div>
        </td>
      </th:block>
      <th:block th:unless="${message.user.id == idFrom}">
        <td align="left">
          <img class="img-responsive" th:src="${'https://i.pravatar.cc/150/img=' + message.user.id}" style="width: 150px; height: 150px;" >
          <div th:text="${message.user.name}"></div>
          <div th:text="${message.content}"></div>
          <div th:text="${#temporals.format(message.timestamp, 'HH:mm')}"></div>
        </td>
      </th:block>
    </tr>
  </table>
</div>

<form class="send-form" th:action="@{/message/send}" th:object="${message}" method="post">
  <input id="newMessage" type="text" name="content" class="float-left" maxlength="100">
  <input type="hidden" name="user" th:value="${idFrom}">
  <input type="hidden" name="userTo" th:value="${idTo}">
  <button id="btn" class="btn btn-primary" disabled="true">Send</button>
</form>

<div th:replace="/fragments/base :: footer"></div>

<div th:replace="/fragments/base :: script-import"></div>

<script type="text/javascript" th:inline="javascript">
  $(function(){
    $("#newMessage").on("keyup", function() {
      if ($(this).val().length === 0) {
        $("#btn").prop("disabled", true);
      } else {
        $("#btn").prop("disabled", false);
      }
    });
  });

  var $scrollTable = $("#scrollTable");
  var scrollTo = $scrollTable.get(0).scrollHeight - $scrollTable.height();
  $(window).on("load", function() { $("#scrollTable").scrollTop(scrollTo); });
</script>

</body>

</html>